
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the Skill Garden application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "userName": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "dateJoined": {
          "type": "string",
          "description": "The date and time the user joined the Skill Garden.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userName",
        "email",
        "dateJoined"
      ]
    },
    "Stem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stem",
      "type": "object",
      "description": "Represents a stem in the skill garden, used to organize related skills.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stem."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Stem)"
        },
        "name": {
          "type": "string",
          "description": "The name of the stem."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the stem."
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the stem was created."
        },
        "icon": {
            "type": "string",
            "description": "The icon for the stem (e.g., Lucide icon name)."
        },
        "color": {
            "type": "string",
            "description": "The accent color for the stem (HEX code)."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "createdAt",
        "icon",
        "color",
        "description"
      ]
    },
    "Leaf": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Leaf",
      "type": "object",
      "description": "Represents a leaf (skill) in the skill garden.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaf."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this leaf."
        },
        "stemId": {
          "type": "string",
          "description": "Reference to Stem. (Relationship: Stem 1:N Leaf)"
        },
        "name": {
          "type": "string",
          "description": "The name of the skill (leaf)."
        },
        "notes": {
          "type": "string",
          "description": "Notes related to the skill."
        },
        "link": {
          "type": "string",
          "description": "A single resource link related to the skill."
        },
        "masteryLevel": {
          "type": "number",
          "description": "A calculated percentage (0-100) representing skill mastery."
        },
        "quests": {
          "type": "array",
          "description": "A list of tasks or goals to achieve for this skill.",
          "items": {
            "$ref": "#/backend/entities/Quest"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "stemId",
        "name"
      ]
    },
    "Quest": {
        "title": "Quest",
        "type": "object",
        "description": "A single task or goal associated with a Leaf (skill).",
        "properties": {
            "id": { "type": "string" },
            "text": { "type": "string" },
            "completed": { "type": "boolean" },
            "order": { "type": "number" }
        },
        "required": ["id", "text", "completed", "order"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Only the authenticated user can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stems/{stemId}",
        "definition": {
          "entityName": "Stem",
          "schema": {
            "$ref": "#/backend/entities/Stem"
          },
          "description": "Stores stem information for a specific user. Only the authenticated user can read/write their own stems.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "stemId",
              "description": "The unique identifier of the stem."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/leaves/{leafId}",
        "definition": {
          "entityName": "Leaf",
          "schema": {
            "$ref": "#/backend/entities/Leaf"
          },
          "description": "Stores all leaves for a user in a single collection for efficient querying. Security rules ensure a user can only access their own leaves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "leafId",
              "description": "The unique identifier of the leaf."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging. Stems and leaves are now stored in separate top-level collections under the user's ID. This denormalized approach allows for more efficient queries (e.g., fetching all leaves for a user without needing to traverse stems) and simplifies security rules. Authorization is still achieved by using path-based ownership for all user-specific data."
  }
}
